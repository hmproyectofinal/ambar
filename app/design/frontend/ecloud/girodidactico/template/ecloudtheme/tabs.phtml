<?php
/**
* Magento
*
* NOTICE OF LICENSE
*
* This source file is subject to the Academic Free License (AFL 3.0)
* that is bundled with this package in the file LICENSE_AFL.txt.
* It is also available through the world-wide-web at this URL:
* http://opensource.org/licenses/afl-3.0.php
* If you did not receive a copy of the license and are unable to
* obtain it through the world-wide-web, please send an email
* to license@magento.com so we can send you a copy immediately.
*
* DISCLAIMER
*
* Do not edit or add to this file if you wish to upgrade Magento to newer
* versions in the future. If you wish to customize Magento for your
* needs please refer to http://www.magento.com for more information.
*
* @category    design
* @package     ecloud_giro
* @copyright   Ecloud ®.
* @license     http://opensource.org/licenses/afl-3.0.php  Academic Free License (AFL 3.0)
*/
?>
<?php
$_helper        = $this->helper('catalog/output');
$tabCategories  = explode(",", $this->getData('categories')); //categories
$_entity = 'catalog_product';
?>

<div class="hometabs container">
	<div id="target" class="banner-content">
		<ul id="tabs" class="col-xs-12"></ul>
		<div id="content" class="tabs-content col-xs-12"></div>
	</div>
</div>

<div class="tabs_source" style="display:none;">
	<?php $i = 0; ?>
	<?php foreach($tabCategories as $categoryId) : ?>
		<?php
			$i++;
			$categoryId 		= (int) $categoryId;
			$category  			= Mage::getModel('catalog/category')->load($categoryId);//category_id
			$categoryName  		= $category->getName();
			$subcatUrl  		= $category->getUrl();
			$catImg  	    	= $category->getImageUrl();
			$catDescription  	= $category->getDescription();
			$href  		        = strtolower($categoryName);
			$href  		        = preg_replace('/\s+/', '', $href);
			$prodCollection 	= $category->getProductCollection()
									->addAttributeToSelect(array('name','special_price', 'price','image', 'edad_fabrica','news_from_date', 'news_to_date', 'featured_product'))
									->addAttributeToSort('position', 'ASC')
									->setPageSize(14);
		?>
		<li class="category_tab <?php echo $href; ?>" target="#tab<?php echo $i; ?>"> <span><?php echo $categoryName; ?> </span> </li>
		<ul id="tab<?php echo $i; ?>" class="category_content <?php echo $href; ?> products-grid">
			<?php foreach($prodCollection as $_product) : ?>
				<li class="item">
					<a class="product-image" href="<?php echo $_product->getProductUrl();?>">
						<img src='<?php echo $this->helper('catalog/image')->init($_product, 'image')->resize(300, 300) ?>'/>
					 	<?php // Cucardas (Databunch) on product listing page ?>
					 	<?php echo $this->getLayout()->createBlock('labels/catalog_product')->setProduct($_product)->toHtml(); ?>
	                    <?php /* $labelsBlock = $this->getChild('product_labels'); ?>
	                    <?php if ($labelsBlock): ?>
	                        <?php echo $labelsBlock->setProduct($_product)->toHtml(); ?>
	                    <?php endif; */ ?>
					</a>
					<div class="product-info col-xs-12">
						<a href="<?php echo $_product->getProductUrl();?>"><span class="product-name col-xs-12" title="<?php echo $_product->getName();?>"><?php $prodName = /*(strlen($_product->getName()) > 45) ? substr($_product->getName(),0,45).'...' :*/ $_product->getName();?><?php echo $prodName; ?>
						</span></a>
						<div class="review">
							<?php echo $this->getReviewsSummaryHtml($_product, 'default', false)?>
						</div>
						<div class="stock">
							<?php if($_product->getStockItem() && $_product->getStockItem()->getIsInStock()): ?>
								<p class="availability in-stock">
						            <span class="label"><?php echo $this->helper('catalog')->__('Availability:') ?></span>
						            <span class="value"><?php echo $this->helper('catalog')->__('In stock') ?></span>
						        </p> 
							<?php else: ?>
							    <p class="availability out-of-stock">
						            <span class="label"><?php echo $this->helper('catalog')->__('Availability:') ?></span>
						            <span class="value"><?php echo $this->helper('catalog')->__('Out of stock') ?></span>
						        </p>
							<?php endif; ?>
						</div>
						<?php 
						    $_attr_edad_fabrica = Mage::getResourceModel('catalog/eav_attribute')->loadByCode($_entity,'edad_fabrica'); 
						    if($_attr_edad_fabrica->getId()): 
						?>
							<?php if($_product->getAttributeText('edad_fabrica') != ''): ?>
								<span class="etiqueta edad">
		                       		<?php echo $this->__('Edad: ').$_product->getAttributeText('edad_fabrica') ?>
		                    	</span>
	                    	<?php endif; ?>
	                    <?php endif; ?>
						<span class="prodprice col-xs-12"><?php echo $this->getPriceHtml($_product,true); ?></span>
						<?php if(!$_product->canConfigure() && $_product->isSaleable()): ?>
	                        <button type="button" title="<?php echo $this->quoteEscape($this->__('Add to cart')) ?>" class="button btn-cart" onclick="setLocation('<?php echo $this->getAddToCartUrl($_product) ?>')"><span><span><?php echo $this->__('Add to cart') ?></span></span></button>
	                    <?php elseif($_product->getStockItem() && $_product->getStockItem()->getIsInStock()): ?>
	                        <div class="buy-button"><a title="<?php echo $this->quoteEscape($this->__('Add to cart')) ?>" class="button" href="<?php echo $_product->getProductUrl() ?>"><?php echo $this->__('Add to cart') ?></a></div>
	                    <?php else: ?>
	                        <div class="buy-button"><a title="<?php echo $this->quoteEscape($this->__('Ver más')) ?>" class="button" href="<?php echo $_product->getProductUrl() ?>"><?php echo $this->__('Ver más') ?></a></div>
	                    <?php endif; ?>
					</div>
				</li>
			<?php endforeach;?>
		</ul>
	<?php endforeach; ?>
</div>
